# 防火墙

——18/09/10, ——By Veeupup

> 资料来源：《信息安全完全参考手册》，清华大学出版社，第二版，第十五章

## 概述

防火墙是内部网络和不可信任网络之间的第一道防线。

### 防火墙发展历程

* 第一代防火墙：工作在第三层网络层，对网络数据流进行允许和拒绝的简单控制引擎，类似访问列表控制列表功能的装置。基于包头的包过滤技术，识别访问源和访问目标的OSI的第四层信息（端口）。
* 第二代防火墙：工作在第四层传输层，能够有效的跟踪活动的网络会话，通常被称为“状态防火墙”，跟踪网络会话，防止MITM中间人攻击。有些还实现了HA，不同主机交换会话列表。
* 第三代防火墙：工作在第七层应用层。能够对网络数据流中被定义和预配置的应用数据进行解码，HTTP,DNS等。可以用来防范SQL注入，XSS攻击等。
* 第四代防火墙：智能分析网络流量中的数据包载荷并理解应用程序的工作原理。可以作为路由器的一个功能模块。

### 应用控制

第四代防火墙可以阻止那些被安全策略所禁止的应用程序的基本能力，但通常无法控制应用程序的行为。

例如：P2P文件共享，基于浏览器的文件共享，Web邮件，网络代理和绕过器，远程访问。

当应用程序加密流量之后，可以通过内部数据流的唯一签名来实现，也可以通过TCP的握手模型。

### 防火墙必备功能

* 应用感知：防火墙必须能处理和解析OSI第三层和第七层的网络流量。
* 精确的应用程序指纹识别
* 细粒度应用程序控制
* 带宽管理（QoS）

### 防火墙核心功能

* 网络地址转换 NAT

  * 静态NAT
  * 动态NAT：从攻击者角度来看，这个系统提供了不断变化的IP地址，给攻击者定位某个具体的系统变得很困难，但是数量有限制。

  将私有地址转换成公网IP，在RFC 1918中定义的私有地址

| 地址        | 掩码        | 地址段                      |
| ----------- | ----------- | --------------------------- |
| 10.0.0.0    | 255.0.0.0   | 10.0.0.0~10.255.255.255     |
| 172.16.0.0  | 255.240.0.0 | 172.16.0.0~172.31.255.255   |
| 192.168.0.0 | 255.255.0.0 | 192.168.0.0~192.168.255.255 |

​	NAT是独立于防火墙策略和规则集单独实现的。

**端口地址转换PAT**：内部空间地址被映射到全局地址上。提高了系统的安全水平，因为不允许直接向内部建立连接。

* 审计与日志：监控网络流量并记录日志保存。

### 防火墙附加功能

* 阻断应用程序和网站恶意代码的执行
* 防病毒
* 入侵检测与入侵防护
* Web内容过滤和缓存
* 垃圾邮件过滤
* 提升网络性能

## 防火墙设计

* 所有通信必须通过防火墙
* 防火墙只允许授权的流量通过
* 在出现故障或超负荷的情况下，防火墙必须一直处于拒绝所有通信或者关闭的状态
* 防火墙的设计和配置必须考虑自身的防攻击能力

### 防火墙的优势和劣势

* 优势
  * 出色的执行安全策略
  * 可用于限制对特定服务的访问
  * 在网络中是透明的，终端用户无须安装软件
  * 提供审计功能
  * 可以向相关人员对指定事件进行报警
* 劣势：
  * 只有当规则被执行了才有效
  * 无法阻止社会工程学攻击和授权用户的恶意操作
  * 无法执行未定义的或不存在的安全策略
  * 无法阻止未经过它的攻击行为

### 防火墙部署

位于网络边界，直接连接内部网络和外部网络。有的位于内部网络的边界。

### 防火墙配置

* 规则从细到粗。一般都是从上到下依次匹配
* 将最活跃的的规则放在最上方
* 应配置畸形的或者不可路由的数据包

